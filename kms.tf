# Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
# SPDX-License-Identifier: MIT-0

resource "aws_kms_key" "secretsmanager" {
  enable_key_rotation     = true
  deletion_window_in_days = 7
  policy = templatefile(
    "${path.module}/policies/key_policy.tftpl",
    {
      caller_arn = data.aws_caller_identity.current.arn
      account_id = data.aws_caller_identity.current.account_id,
      region     = data.aws_region.current.name
    }
  )
}

resource "aws_kms_alias" "secretsmanager" {
  name          = "alias/VT-API-key"
  target_key_id = aws_kms_key.secretsmanager.id
}